<!DOCTYPE html>
<html>

<head>
  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-7726590371480649" crossorigin="anonymous"></script>
  <link rel="stylesheet" href="/styles/header.css" type="text/css">
  <link rel="icon" href="/assets/images/foxycake.png">
  <title>Foxy | Loja</title>
  <link rel="stylesheet" href="/styles/dashboard.css" type="text/css">
</head>

<body>
  <%- include('../../../global/header') %>
  <main>
    <div class="itens">
      <% storeContent.backgrounds.forEach(background=> { %>
      <% if (background.cakes==0 || background.inactive) { return; } %>
      <div class="item <%= userBackgrounds.includes(background.id) ? " disabled" : "" %>" <% if (!userBackgrounds.includes(background.id)) { %> onclick="showPopup(<%= JSON.stringify(background) %>, <%= JSON.stringify(userData) %>)" <% } %>>
        <div class="item__icon">
          <img class="background" src="https://orchid.cakeyfox.live/assets/backgrounds/<%= background.filename %>" onerror="this.src='https://cakey.foxybot.win/assets/backgrounds/<%= background.filename %>'">
        </div>
        <div class="item_info">
          <h1 class="item-name">
            <%= background.name %>
          </h1>
          <% if (userData.userProfile.backgroundList.includes(background.id)) { %>
          <span class="purchased">ðŸ’– JÃ¡ comprado</span>
          <% } else { %>
          <span class="cakes">
            <%= background.cakes.toLocaleString("pt-BR") %> Cakes
          </span>
          <% } %>
        </div>
      </div>
      <% }); %>
    </div>

    <%- include('../../sidebar') %>
  </main>
  <div id="popup" class="popup">
    <div class="popup-content">
      <span class="close" onclick="hidePopup()">&times;</span>

      <h2 id="bg-title"></h2>
      <img id="popup-img" src="">
      <h3 id="bg-description"></h3>
      <h3 id="bg-description">VocÃª possui <strong style="color: #e7385d;">
          <%= userData.userCakes.balance.toLocaleString("pt-BR") %>
        </strong> Cakes</h3>

      <form id="purchaseForm" method="POST">
        <input type="hidden" name="backgroundId" id="backgroundId">
        <button class="server__button" id="save" type="submit">
          Comprar
        </button>
      </form>
    </div>
  </div>

  <script>
    function showPopup(background, userData) {
      document.getElementById('backgroundId').value = background.id;
      document.getElementById('popup').style.display = 'block';
      document.getElementById('bg-title').innerText = background.name;
      document.getElementById('bg-description').innerText = background.description;
      document.getElementById('popup-img').src = "https://orchid.cakeyfox.live/assets/backgrounds/" + background.filename;
      document.getElementById('popup-img').onerror = function() {
        this.src = "https://cakey.foxybot.win/assets/backgrounds/" + background.filename;
      };

      if (userData.userCakes.balance < background.cakes) {
        document.getElementById('save').disabled = true;
      }
    }

    document.getElementById('purchaseForm').addEventListener('submit', function(event) {
      var backgroundId = document.getElementById('backgroundId').value;
      this.action = "/br/store/confirm/" + backgroundId;
    });

    function hidePopup() {
      document.getElementById('popup').style.display = 'none';
    }
  </script>
</body>
<script src="../js/HeaderMobile.js"></script>

</html>

<style>

</style>